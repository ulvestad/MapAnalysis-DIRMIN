<!DOCTYPE html>
<html>
<body>
<script type="text/javascript">
var fs = require('fs');
//Using node.js to get an array with the files from the metadata folder
var files = fs.readdirSync('userInterface/metadata/');
var pictures = fs.readdirSync('userInterface/mapPictures');

//Function to create file objects from the metadata directory
function metadataFile(files) {
  urlList = [];
  //creating all files in the metadata folder
  for (i=0, j=files.length; i<j; i++){
    var file = new File([""], files[0,i], {path: "metadata/" + files[0,i]});
    console.log(file);
    url = "metadata/" + file.name;
    console.log(url);
    urlList.push(url);
    console.log(urlList);
  }
  //Creating HttpRequest for each file in the metadatafolder
  for (i=0, j=files.length; i<j; i++){
    files = new XMLHttpRequest();
    console.log(files);
    files.open("GET", urlList[0,i], true);
    //Checking if request is good, and sending xml file to xmlparser to parse the file
    files.onreadystatechange = function () {
      if (files.readyState == 4 && files.status == 200) {
        xmlparser(files);
      }
    }
    files.send();
  }
}

//Main function
window.onload = function(){
    metadataFile(files);
}

/*function destroyClickedElement(event)
{
    document.body.removeChild(event.target);
}*/


//function to fetch coordinates and filename, parameter is xmlfile
function xmlparser(xml) {
  var east, west, north, south, i, xmlDoc, xmlData;
  xmlDoc = xml.responseXML;
  xmlData = [];
  for (i = 0; i< files.length; i++) {
    east = xmlDoc.getElementsByTagName("eastBP")[0].childNodes[0].nodeValue;
    west = xmlDoc.getElementsByTagName("westBP")[0].childNodes[0].nodeValue;
    north = xmlDoc.getElementsByTagName("northBP")[0].childNodes[0].nodeValue;
    south = xmlDoc.getElementsByTagName("southBP")[0].childNodes[0].nodeValue;
    filename = xmlDoc.getElementsByTagName("mdFilename")[0].childNodes[0].nodeValue;
    xmlData.push(east,west,north,south, filename);
  }
  console.log(xmlData);
  /*var textToSave = xmlData;
  var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
  var textToSaveAsURL = window.URL.createObjectURL(textToSaveAsBlob);
  var fileNameToSaveAs = "coordinates.txt";

  var downloadLink = document.createElement("a");
  downloadLink.download = fileNameToSaveAs;
  downloadLink.innerHTML = "Download File";
  downloadLink.href = textToSaveAsURL;
  downloadLink.onclick = destroyClickedElement;
  downloadLink.style.display = "none";
  document.body.appendChild(downloadLink);

  downloadLink.click();*/
}
</script>
</body>
</html>
